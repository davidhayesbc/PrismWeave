<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Detection Test</title>
</head>
<body>
    <h1>URL Detection Test</h1>
    <div id="output"></div>
    
    <script>
        // Copy of the detectInjectableBaseUrl logic for testing
        function detectInjectableBaseUrl() {
            const currentUrl = window.location.href;
            console.log('Current URL:', currentUrl);

            // If running on GitHub Pages
            if (currentUrl.includes('github.io') || currentUrl.includes('davidhayesbc.github.io')) {
                const url = new URL(window.location.href);
                console.log('URL object:', url);
                
                const pathParts = url.pathname.split('/').filter(part => part);
                console.log('Path parts:', pathParts);
                
                const prismweaveIndex = pathParts.findIndex(part => part.toLowerCase() === 'prismweave');
                console.log('PrismWeave index:', prismweaveIndex);
                
                if (prismweaveIndex >= 0) {
                    const basePath = '/' + pathParts.slice(0, prismweaveIndex + 1).join('/');
                    console.log('Base path:', basePath);
                    const finalUrl = `${url.origin}${basePath}/injectable`;
                    console.log('Final URL:', finalUrl);
                    return finalUrl;
                }
                
                console.log('PrismWeave not found in path, using fallback');
                return `${url.origin}/PrismWeave/injectable`;
            }

            return 'https://davidhayesbc.github.io/PrismWeave/injectable';
        }

        // Test scenarios
        const testScenarios = [
            'https://davidhayesbc.github.io/PrismWeave/',
            'https://davidhayesbc.github.io/PrismWeave/bookmarklet/',
            'https://davidhayesbc.github.io/PrismWeave/bookmarklet/generator.html',
            'https://localhost:3000/bookmarklet/',
        ];

        function testUrlDetection(testUrl) {
            // Temporarily change window.location for testing
            const originalLocation = window.location;
            
            // Mock window.location
            delete window.location;
            window.location = new URL(testUrl);
            
            const result = detectInjectableBaseUrl();
            
            // Restore original location
            window.location = originalLocation;
            
            return result;
        }

        // Run tests and display results
        const outputDiv = document.getElementById('output');
        let html = '<h2>Test Results:</h2>';
        
        testScenarios.forEach(testUrl => {
            const result = testUrlDetection(testUrl);
            html += `<p><strong>Input:</strong> ${testUrl}<br><strong>Output:</strong> ${result}</p>`;
        });
        
        // Test with current page
        const currentResult = detectInjectableBaseUrl();
        html += `<h3>Current Page:</h3><p><strong>URL:</strong> ${window.location.href}<br><strong>Detected:</strong> ${currentResult}</p>`;
        
        outputDiv.innerHTML = html;
        
        // Test if the detected URL actually works
        async function testInjectableUrl() {
            try {
                const response = await fetch(currentResult + '/content-extractor-injectable.js', { method: 'HEAD' });
                const statusDiv = document.createElement('div');
                statusDiv.innerHTML = `<h3>Injectable File Test:</h3><p>Status: ${response.ok ? '✅ Working' : '❌ Failed'} (${response.status})</p>`;
                outputDiv.appendChild(statusDiv);
            } catch (error) {
                const statusDiv = document.createElement('div');
                statusDiv.innerHTML = `<h3>Injectable File Test:</h3><p>❌ Error: ${error.message}</p>`;
                outputDiv.appendChild(statusDiv);
            }
        }
        
        testInjectableUrl();
    </script>
</body>
</html>