// Generated by Copilot
// Test script to verify the Anthropic content extraction fix
// Run this in the browser console on https://www.anthropic.com/research/project-vend-1?utm_source=tldrwebdev

console.log('ğŸ§ª Testing Anthropic Content Extraction Fix...');

// Test the updated cleaning logic
async function testAnthropicCleaningFix() {
  console.log('1ï¸âƒ£ Testing domain detection...');
  const hostname = window.location.hostname;
  const pathname = window.location.pathname;
  console.log(`Domain: ${hostname}, Path: ${pathname}`);

  // Check if research page detection works
  const isResearchPage =
    hostname.includes('anthropic.com') ||
    pathname.includes('/research/') ||
    window.location.href.toLowerCase().includes('research');
  console.log(`âœ… Research page detected: ${isResearchPage}`);

  console.log('\n2ï¸âƒ£ Testing content extraction with fix...');

  // Find main content with Anthropic selectors
  const anthropicSelectors = [
    'main',
    '[role="main"]',
    '.research-post',
    '.post-content',
    '.content',
    'article',
    '.article-content',
    '.markdown-content',
    '.prose',
    '.max-w-prose',
    '.max-w-4xl',
    '[class*="content"]',
    '[class*="article"]',
    '[class*="post"]',
    '[class*="text"]',
    'div[class*="mx-auto"]',
    'div[class*="container"]',
  ];

  let mainContent = null;
  for (const selector of anthropicSelectors) {
    const element = document.querySelector(selector);
    if (element && element.textContent && element.textContent.trim().length > 1000) {
      mainContent = element;
      console.log(`âœ… Found content with selector: ${selector}`);
      console.log(`   Content length: ${element.textContent.trim().length} characters`);
      break;
    }
  }

  if (!mainContent) {
    console.log('âŒ No main content found with selectors');
    return;
  }

  console.log('\n3ï¸âƒ£ Testing gentle cleaning for research page...');

  // Clone the content for testing
  const originalContent = mainContent.cloneNode(true);
  const testContent = mainContent.cloneNode(true);

  // Apply only essential cleaning (scripts, styles)
  const scriptsAndStyles = testContent.querySelectorAll('script, style, noscript');
  scriptsAndStyles.forEach(el => el.remove());

  // Apply minimal navigation removal (be very selective)
  const navigation = testContent.querySelectorAll('nav, .navigation, .navbar');
  navigation.forEach(el => {
    // Only remove if it's clearly navigation and not part of content
    const text = el.textContent?.toLowerCase() || '';
    if (text.includes('menu') || text.includes('navigation') || text.includes('nav')) {
      el.remove();
    }
  });

  // Remove obvious ads only
  const obviousAds = testContent.querySelectorAll(
    '.google-ad, .advertisement, [id*="google_ads"], .banner-ad'
  );
  obviousAds.forEach(el => el.remove());

  // DON'T remove content by text analysis for research pages
  console.log('âš ï¸  Skipping aggressive text-based ad removal for research page');

  console.log('\n4ï¸âƒ£ Comparing content preservation...');
  const originalText = originalContent.textContent?.trim() || '';
  const cleanedText = testContent.textContent?.trim() || '';
  const wordsBefore = originalText.split(/\s+/).filter(w => w.length > 0).length;
  const wordsAfter = cleanedText.split(/\s+/).filter(w => w.length > 0).length;
  const preservationRate = ((wordsAfter / wordsBefore) * 100).toFixed(1);

  console.log(`ğŸ“Š Content Analysis:`);
  console.log(`   Words before cleaning: ${wordsBefore}`);
  console.log(`   Words after cleaning: ${wordsAfter}`);
  console.log(`   Preservation rate: ${preservationRate}%`);

  // Check for key content indicators
  const hasTitle = cleanedText.includes('Project VEND') || cleanedText.includes('anthropic');
  const hasSubstantialContent = wordsAfter > 1000;
  const hasResearchContent =
    cleanedText.toLowerCase().includes('research') ||
    cleanedText.toLowerCase().includes('model') ||
    cleanedText.toLowerCase().includes('evaluation');

  console.log(`\n5ï¸âƒ£ Content Quality Check:`);
  console.log(`   Has title/header: ${hasTitle ? 'âœ…' : 'âŒ'}`);
  console.log(`   Has substantial content (>1000 words): ${hasSubstantialContent ? 'âœ…' : 'âŒ'}`);
  console.log(`   Has research content: ${hasResearchContent ? 'âœ…' : 'âŒ'}`);

  // Success criteria
  const isSuccessful = preservationRate > 80 && hasSubstantialContent && hasResearchContent;

  console.log(`\nğŸ¯ Overall Result: ${isSuccessful ? 'âœ… SUCCESS' : 'âŒ NEEDS IMPROVEMENT'}`);

  if (isSuccessful) {
    console.log(
      'ğŸ‰ The fix appears to be working! Content cleaning is now preserving research content.'
    );
  } else {
    console.log('âš ï¸  The fix may need adjustment. Content preservation is still insufficient.');
  }

  // Show a sample of preserved content
  console.log('\nğŸ“ Sample of preserved content:');
  console.log(cleanedText.substring(0, 500) + '...');

  return {
    success: isSuccessful,
    preservationRate: preservationRate,
    wordsBefore: wordsBefore,
    wordsAfter: wordsAfter,
    hasTitle: hasTitle,
    hasSubstantialContent: hasSubstantialContent,
    hasResearchContent: hasResearchContent,
  };
}

// Run the test
testAnthropicCleaningFix()
  .then(result => {
    console.log('\nğŸ“‹ Test Results Summary:', result);
  })
  .catch(error => {
    console.error('âŒ Test failed:', error);
  });
