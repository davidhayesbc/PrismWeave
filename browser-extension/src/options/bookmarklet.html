<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>PrismWeave - Bookmarklet Manager</title>
    <link
      rel="stylesheet"
      href="options.css"
    />
    <style>
      /* Bookmarklet-specific styles */
      .bookmarklet-section {
        background: var(--background-secondary);
        border-radius: 8px;
        padding: 24px;
        margin-bottom: 24px;
        border: 1px solid var(--border-color);
      }

      .bookmarklet-preview {
        background: var(--background-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 16px;
        margin: 16px 0;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.4;
        max-height: 200px;
        overflow-y: auto;
        word-break: break-all;
      }

      .bookmarklet-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }

      .install-instructions {
        background: var(--background-info);
        border: 1px solid var(--border-info);
        border-radius: 4px;
        padding: 16px;
        margin: 16px 0;
      }

      .install-instructions h4 {
        margin: 0 0 12px 0;
        color: var(--text-primary);
      }

      .install-instructions ol {
        margin: 0;
        padding-left: 20px;
      }

      .install-instructions li {
        margin-bottom: 8px;
        color: var(--text-secondary);
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .status-indicator.enabled {
        background: var(--background-success);
        color: var(--text-success);
      }

      .status-indicator.disabled {
        background: var(--background-warning);
        color: var(--text-warning);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: currentColor;
      }

      /* Grid layout for configuration */
      .config-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      @media (max-width: 768px) {
        .config-grid {
          grid-template-columns: 1fr;
        }

        .bookmarklet-actions {
          flex-direction: column;
        }
      }

      /* Loading and error states */
      .loading {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        color: var(--text-secondary);
      }

      .error {
        background: var(--background-error);
        color: var(--text-error);
        border: 1px solid var(--border-error);
        border-radius: 4px;
        padding: 12px;
        margin: 12px 0;
      }

      .success {
        background: var(--background-success);
        color: var(--text-success);
        border: 1px solid var(--border-success);
        border-radius: 4px;
        padding: 12px;
        margin: 12px 0;
      }

      /* Sharing and Statistics Styles */
      .share-actions,
      .stats-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 8px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin: 20px 0;
      }

      .stat-card {
        background: var(--background-secondary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 20px;
        text-align: center;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: var(--accent-color);
        margin-bottom: 8px;
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .domain-list {
        background: var(--background-secondary);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        padding: 12px;
        max-height: 200px;
        overflow-y: auto;
      }

      .domain-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid var(--border-color);
      }

      .domain-item:last-child {
        border-bottom: none;
      }

      .domain-name {
        font-weight: 500;
      }

      .domain-count {
        background: var(--accent-color);
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="logo">
            <img
              src="../icons/icon-48.png"
              alt="PrismWeave"
            />
          </div>
          <div class="header-text">
            <h1>Bookmarklet Manager</h1>
            <p>Generate and manage bookmarklets for capturing web content</p>
          </div>
        </div>
        <nav class="nav-tabs">
          <a
            href="options.html"
            class="nav-tab"
          >
            Settings
          </a>
          <a
            href="bookmarklet.html"
            class="nav-tab active"
          >
            Bookmarklet
          </a>
        </nav>
      </header>

      <!-- Status Section -->
      <section class="bookmarklet-section">
        <div class="section-header">
          <h2>Bookmarklet Status</h2>
          <div
            id="bookmarklet-status"
            class="status-indicator disabled"
          >
            <div class="status-dot"></div>
            <span>Disabled</span>
          </div>
        </div>

        <div class="checkbox-group">
          <input
            type="checkbox"
            id="enable-bookmarklet"
          />
          <label for="enable-bookmarklet">Enable bookmarklet functionality</label>
        </div>

        <p class="field-description">
          When enabled, you can generate bookmarklets to capture content from any website without installing the browser
          extension on other devices.
        </p>
      </section>

      <!-- Configuration Section -->
      <section
        class="bookmarklet-section"
        id="config-section"
        style="display: none"
      >
        <h2>Configuration</h2>

        <div class="config-grid">
          <div class="field-group">
            <label for="custom-domain">Custom Endpoint (Optional)</label>
            <input
              type="url"
              id="custom-domain"
              placeholder="https://yourserver.com/bookmarklet"
            />
            <p class="field-description">Leave empty to use extension's GitHub integration</p>
          </div>

          <div class="field-group">
            <label for="bookmarklet-version">Version</label>
            <input
              type="text"
              id="bookmarklet-version"
              value="1.0.0"
              pattern="^\d+\.\d+\.\d+$"
              readonly
            />
            <p class="field-description">Current bookmarklet version</p>
          </div>
        </div>

        <h3>Content Extraction Options</h3>
        <div class="config-grid">
          <div class="checkbox-group">
            <input
              type="checkbox"
              id="include-images"
              checked
            />
            <label for="include-images">Include images</label>
          </div>

          <div class="checkbox-group">
            <input
              type="checkbox"
              id="include-links"
              checked
            />
            <label for="include-links">Include links</label>
          </div>

          <div class="checkbox-group">
            <input
              type="checkbox"
              id="clean-ads"
              checked
            />
            <label for="clean-ads">Remove advertisements</label>
          </div>

          <div class="checkbox-group">
            <input
              type="checkbox"
              id="auto-install"
            />
            <label for="auto-install">Auto-update bookmarklet</label>
          </div>
        </div>

        <div class="field-group">
          <label for="custom-include-selectors">Custom Include Selectors</label>
          <textarea
            id="custom-include-selectors"
            placeholder="article, .content, #main-content"
            rows="3"
          ></textarea>
          <p class="field-description">CSS selectors for elements to always include (comma-separated)</p>
        </div>

        <div class="field-group">
          <label for="custom-exclude-selectors">Custom Exclude Selectors</label>
          <textarea
            id="custom-exclude-selectors"
            placeholder="nav, header, footer, .advertisement"
            rows="3"
          ></textarea>
          <p class="field-description">CSS selectors for elements to exclude (comma-separated)</p>
        </div>
      </section>

      <!-- Generated Bookmarklet Section -->
      <section
        class="bookmarklet-section"
        id="bookmarklet-section"
        style="display: none"
      >
        <h2>Generated Bookmarklet</h2>

        <div
          class="bookmarklet-preview"
          id="bookmarklet-preview"
        >
          <div class="loading">
            <div class="status-dot"></div>
            Generating bookmarklet...
          </div>
        </div>

        <div class="bookmarklet-actions">
          <button
            type="button"
            class="btn btn-primary"
            id="copy-bookmarklet"
          >
            Copy Bookmarklet
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            id="test-bookmarklet"
          >
            Test on Current Page
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            id="regenerate-bookmarklet"
          >
            Regenerate
          </button>
        </div>

        <!-- Installation Instructions -->
        <div class="install-instructions">
          <h4>Installation Instructions</h4>
          <ol>
            <li>Copy the bookmarklet code above using the "Copy Bookmarklet" button</li>
            <li>Create a new bookmark in your browser</li>
            <li>Set the bookmark name to "PrismWeave Capture"</li>
            <li>Paste the copied code as the bookmark URL</li>
            <li>Save the bookmark to your bookmarks bar for easy access</li>
            <li>Click the bookmark on any webpage to capture content</li>
          </ol>
        </div>
      </section>

      <!-- Test Results Section -->
      <section
        class="bookmarklet-section"
        id="test-results-section"
        style="display: none"
      >
        <h2>Test Results</h2>
        <div id="test-results"></div>
      </section>

      <!-- Action Buttons -->
      <div class="button-group">
        <button
          type="button"
          class="btn btn-primary"
          id="save-bookmarklet-settings"
        >
          Save Settings
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          id="reset-bookmarklet-settings"
        >
          Reset to Defaults
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          id="export-bookmarklet"
        >
          Export Configuration
        </button>
      </div>

      <!-- Sharing Section -->
      <section class="config-section">
        <h2>📤 Bookmarklet Sharing</h2>
        <p>Share your bookmarklet configuration with others or create shareable links.</p>

        <div class="config-group">
          <label for="share-config">Configuration Sharing</label>
          <div class="share-actions">
            <button
              id="export-config"
              class="btn btn-secondary"
              title="Export configuration to JSON file"
            >
              📥 Export Config
            </button>
            <button
              id="import-config"
              class="btn btn-secondary"
              title="Import configuration from JSON file"
            >
              📤 Import Config
            </button>
            <input
              type="file"
              id="config-file-input"
              accept=".json"
              class="hidden"
            />
            <button
              id="generate-share-link"
              class="btn btn-secondary"
              title="Generate shareable bookmarklet link"
            >
              🔗 Generate Share Link
            </button>
          </div>
        </div>

        <div
          id="share-results"
          class="config-group hidden"
        >
          <label>Generated Share Link</label>
          <div class="input-group">
            <input
              type="text"
              id="share-link-display"
              readonly
              placeholder="Share link will appear here..."
            />
            <button
              id="copy-share-link"
              class="btn btn-secondary"
              title="Copy share link to clipboard"
            >
              📋 Copy
            </button>
          </div>
          <div class="help-text">
            This link contains your bookmarklet configuration (excluding sensitive data like GitHub tokens). Share it
            with others to help them set up the same bookmarklet configuration.
          </div>
        </div>
      </section>

      <!-- Usage Statistics Section -->
      <section class="config-section">
        <h2>📊 Usage Statistics</h2>
        <p>Track your bookmarklet usage and performance metrics.</p>

        <div class="stats-grid">
          <div class="stat-card">
            <div
              class="stat-value"
              id="total-uses"
            >
              -
            </div>
            <div class="stat-label">Total Uses</div>
          </div>
          <div class="stat-card">
            <div
              class="stat-value"
              id="successful-captures"
            >
              -
            </div>
            <div class="stat-label">Successful Captures</div>
          </div>
          <div class="stat-card">
            <div
              class="stat-value"
              id="failed-captures"
            >
              -
            </div>
            <div class="stat-label">Failed Captures</div>
          </div>
          <div class="stat-card">
            <div
              class="stat-value"
              id="average-content-length"
            >
              -
            </div>
            <div class="stat-label">Avg Content Length</div>
          </div>
        </div>

        <div class="config-group">
          <label>Most Captured Domains</label>
          <div
            id="top-domains"
            class="domain-list"
          >
            <div class="loading">Loading statistics...</div>
          </div>
        </div>

        <div class="config-group">
          <div class="stats-actions">
            <button
              id="refresh-stats"
              class="btn btn-secondary"
              title="Refresh usage statistics"
            >
              🔄 Refresh Stats
            </button>
            <button
              id="clear-stats"
              class="btn btn-danger"
              title="Clear all usage statistics"
            >
              🗑️ Clear Stats
            </button>
            <button
              id="export-stats"
              class="btn btn-secondary"
              title="Export statistics to CSV"
            >
              📊 Export Stats
            </button>
          </div>
        </div>
      </section>

      <!-- Status Messages -->
      <div id="status-messages"></div>
    </div>

    <script
      type="module"
      src="bookmarklet.js"
    ></script>
  </body>
</html>
